<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8" />
    <title>fake art</title>
    <style type="text/css">
      body {
        display: flex;
        height: 100vh;
        justify-content: center;
        align-items: center;
        flex-direction: column;
      }
      #picture {
        height: 700px;
        width: 500px;
        display: flex;
        flex-wrap: wrap;
      }

      #picture div {
        background-color: grey;
      }
    </style>
  </head>
  <body>
    <script>
      let url = "liza.jpeg";
      //       let url = "vanGog.jpg";
    </script>

    <div id="picture"></div>

    <script>
      //
      // нужно при рисовании генерировать работу
      // - картина рисуется в среднем за 5 секунд
      //
      // нужно её сохранять до продажи
      // - генерим рандомы на каждый «пиксель»
      // - сохраняем все рандомы для каждой картины в local storage
      //
      // нужно её воспроизводить в таком же виде если вышли
      // из браузера и зашли обратно (пока она не продана)
      // - берём рандомы из local storage и генерим картину
      //
      // нужно генерировать новые работы, которые нарисовались
      // в оффлайне и ещё не продались
      // - при загрузке считаем сколько картин нужно нагенерить
      // - генерим картины
      // - кладём в local storage
      // - выводим картины
      //

      function paint() {
        let paintingData = localStorage.painting.split(",");
        let painting = document.getElementById("picture");
        let pixels = painting.childNodes;

        for (var i = 0; i < pixels.length; i++) {
          let pixel = pixels[i];
          let filterCSS = paintingData[i];

          pixel.style.backgroundImage = `url(${url})`;
          pixel.style.filter = `${filterCSS}`;
        }
      }

      document.addEventListener("DOMContentLoaded", () => {
        let elem = document.getElementById("picture");
        // elem.style.backgroundImage = "url(" + url + ")";

        const imW = elem.offsetWidth;
        const imH = elem.offsetHeight;

        const count = 10;

        const divW = imW / count;
        const divH = imH / count;

        let i = 0;
        let y = 0;
        let top = 0;
        let left = 0;

        while (i < count * count) {
          let div = document.createElement("div");
          div.id = "div_" + i;

          if ((y == 0) & (i == 0)) {
            y += 1;
          } else {
            if (y > count - 1) {
              top += divH;
              left = 0;
              y = 1;
            } else {
              left += divW;
              y += 1;
            }
          }

          div.style = `width: ${divW}px;
                       height: ${divH}px;
                       background-size: ${imW}px ${imH}px;
                       background-position: top ${-top}px left ${-left}px;`;

          elem.append(div);

          i += 1;
        }

        setTimeout(() => paint(), 5000);

        // console.log(paintingData);
      });
    </script>
  </body>
</html>
